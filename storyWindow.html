<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href ="stylesheets/style.css">

    <title id="title"></title>

    <div class="options">
        <a button class="myButton">Auto type</a>
        <a button class="myButton">Close</a>
        <a button class="myButton">Mute</a>
    </div>

    <div class="main">
        <h1 id="chapterHeader"></h1>
        <p id="storyWindow"> <!--the writing will go in here --> </p>

        <div class="buttons" id="buttonBox" >
        </div>

    </div>

    <script>

        var storyWindow = document.getElementById("storyWindow");
        var filepath = sessionStorage.getItem("storyDirectory");
        var fs = require('fs'); // Load the File System to execute our common tasks (CRUD)


        var currentChapter = "start";
        const extension = ".txt";


            console.log("Entered while loop");

            //read and output
            fs.readFile(filepath + "/" + currentChapter + extension, 'utf-8', (err, data) => {

                currentChapter = "END";

                //error file
                if(err){
                    alert("An error occurred reading the file :" + err.message);
                    return;
                }

                //debug output
                console.log("The file content is: " + data);

                //iterators for key-press functionality
                var i=0;
                var splitted = data.split(/[\s]/);

                document.addEventListener('keydown', function(event) {
                    if(i<splitted.length){

                        switch (splitted[i]){

                            //Handle headings
                            case ('{HEADING}'):
                                i++;
                                var heading = splitted[i++];
                                console.log("this is before the while");
                                while (splitted[i] !== "{/HEADING}"){
                                    console.log("this is in the while");
                                    heading = heading + " " + splitted[i++];
                                }
                                document.getElementById("chapterHeader").innerText = heading;
                                i++;
                                break;

                            //Handle options
                            case ("{OPTIONS}"):
//                            var buttonBox = document.createElement('div');
//                            buttonBox.className = "buttons";

                                var buttonBox = document.getElementById("buttonBox");
                                i++;

                                while (splitted[i] !== "{/OPTIONS}") {
                                    var buttonName = splitted[i++];
                                    while (splitted[i] !== "="){
                                        buttonName += " " + splitted[i++];
                                    }
                                    console.log(buttonName);
                                    i++; //skip equals sign

                                    var fileName = splitted[i++];
                                    console.log(fileName);

                                    var opButton = document.createElement('button');
                                    opButton.className = "myButton";
                                    opButton.appendChild(document.createTextNode(buttonName));
                                    buttonBox.appendChild(opButton);

                                    opButton.onclick = function () {
                                        // window.location.href = "./" + fileName + ".html";
                                        buttonBox.innerText = ""; //clear buttons

                                    }

                                    console.log(splitted[i]);

                                }

                                console.log("out of loop");
                                i++;
                                break;

                            //Default words
                            default :
                                storyWindow.innerText = storyWindow.innerText + " " + splitted[i];
                                i++;

                        }
                    }
                });

            });




        function processElement(token) {

        }


    </script>

</head>
<body>

</body>
</html>